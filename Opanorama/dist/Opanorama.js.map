{"version":3,"sources":["webpack:///Opanorama.js","webpack:///webpack/bootstrap 1a9744ff6f74773b96cc","webpack:///./src/Opanorama.js","webpack:///./src/orienter.js","webpack:///./src/toucher.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_interopRequireDefault","obj","default","_classCallCheck","instance","Constructor","TypeError","value","_createClass","defineProperties","target","props","length","descriptor","writable","key","protoProps","staticProps","_orienter","_orienter2","_toucher","_toucher2","Opanorama","config","this","_config","assign","url","container","document","body","radius","fov","offsetLongitude","offsetLatitude","supportTouch","supportOrient","onFrame","lon","lat","width","clientWidth","height","clientHeight","_fix","isFixed","_touch","_orient","_initStage","resize","_animate","_initControl","arguments","undefined","renderer","setSize","camera","aspect","updateProjectionMatrix","lookAt","render","scene","THREE","PerspectiveCamera","Vector3","Scene","geometry","SphereBufferGeometry","scale","material","MeshBasicMaterial","map","TextureLoader","load","mesh","Mesh","add","WebGLRenderer","setPixelRatio","window","devicePixelRatio","canvas","domElement","appendChild","addEventListener","_bindResize","_onResize","bind","update","self","onChange","_ref","Math","min","max","_ref2","abs","unbind","destroy","removeEventListener","cancelAnimationFrame","_intFrame","degToRad","x","cos","y","sin","z","requestAnimationFrame","Orienter","onOrient","moothFactor","boundary","direction","orientation","_bindChange","_onChange","_bindOrient","_onOrient","event","lastLon","lastLat","lx","evt","alpha","gamma","beta","_mooth","Toucher","onStart","onMove","onEnd","lastX","lastY","lastDistance","startX","startY","speed","deceleration","factor","_bindStart","_onStart","_bindMove","_onMove","_bindEnd","_onEnd","changedTouches","clientX","clientY","startTime","Date","now","preventDefault","evt1","distance","t","_inertance","_subSpeed","isUserInteracting"],"mappings":"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","file":"Opanorama.js?b0b195444e0c3ad8a21c","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _orienter = __webpack_require__(1);\n\nvar _orienter2 = _interopRequireDefault(_orienter);\n\nvar _toucher = __webpack_require__(2);\n\nvar _toucher2 = _interopRequireDefault(_toucher);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Opanorama = function () {\n    function Opanorama(config) {\n        _classCallCheck(this, Opanorama);\n\n        this._config = Object.assign({\n            url: '', //全景图片\n            container: document.body, //容器\n            radius: 500, //球体半径\n            fov: 90, //相机视角，可用于放大和缩小图片\n            offsetLongitude: 0, //经度偏移量，可用于默认展示图片位置\n            offsetLatitude: 0, //纬度偏移量，可用于默认展示图片位置\n            supportTouch: true, //是否支持手指滑动\n            supportOrient: true, //是否支持陀螺仪\n            onFrame: function onFrame(lon, lat) {\n                return { lon: lon, lat: lat };\n            }\n        }, config);\n\n        this._config.width = config.container.clientWidth;\n        this._config.height = config.container.clientHeight;\n\n        config = this._config;\n\n        this._fix = {\n            lat: config.offsetLatitude || 0,\n            lon: config.offsetLongitude || 180,\n            isFixed: config.offsetLatitude || config.offsetLongitude\n        };\n\n        this._touch = this._orient = {\n            lat: 0,\n            lon: 0\n        };\n\n        this._initStage();\n        this.resize();\n        this._animate();\n        this._initControl();\n    }\n\n    _createClass(Opanorama, [{\n        key: 'update',\n        value: function update() {\n            var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n            this._config = Object.assign({}, this._config, config);\n\n            if (config.width || config.height) {\n                this.renderer.setSize(this._config.width, this._config.height);\n                this.camera.aspect = this._config.width / this._config.height;\n            }\n            if (config.fov) {\n                this.camera.fov = config.fov;\n            }\n            this.camera.updateProjectionMatrix();\n            this.resize();\n        }\n    }, {\n        key: 'resize',\n        value: function resize() {\n            this.camera.lookAt(this.camera.target);\n            this.renderer.render(this.scene, this.camera);\n        }\n    }, {\n        key: '_initStage',\n        value: function _initStage() {\n            var _config = this._config,\n                container = _config.container,\n                width = _config.width,\n                height = _config.height,\n                url = _config.url,\n                fov = _config.fov,\n                radius = _config.radius;\n\n            this.camera = new THREE.PerspectiveCamera(fov, width / height, 1, 1100);\n            this.camera.target = new THREE.Vector3(0, 0, 0);\n            this.scene = new THREE.Scene();\n\n            var geometry = new THREE.SphereBufferGeometry(radius, 60, 40);\n            geometry.scale(-1, 1, 1);\n            var material = new THREE.MeshBasicMaterial({\n                map: new THREE.TextureLoader().load(url)\n            });\n            var mesh = new THREE.Mesh(geometry, material);\n            this.scene.add(mesh);\n\n            this.renderer = new THREE.WebGLRenderer();\n            this.renderer.setPixelRatio(window.devicePixelRatio);\n            this.renderer.setSize(width, height);\n            this.canvas = this.renderer.domElement;\n            container.appendChild(this.canvas);\n\n            window.addEventListener('resize', this._bindResize = this._onResize.bind(this));\n        }\n    }, {\n        key: '_onResize',\n        value: function _onResize() {\n            var container = this._config.container;\n\n            this.update({\n                width: container.clientWidth,\n                height: container.clientHeight\n            });\n        }\n    }, {\n        key: '_initControl',\n        value: function _initControl() {\n            var self = this;\n            var config = this._config;\n\n            if (config.supportTouch) {\n                var fov = void 0;\n                this._toucher = new _toucher2.default({\n                    container: config.container,\n                    radius: config.radius,\n                    onChange: function onChange(_ref) {\n                        var lon = _ref.lon,\n                            lat = _ref.lat,\n                            scale = _ref.scale;\n\n                        if (scale) {\n                            fov = self._config.fov / scale;\n                            fov = Math.min(120, Math.max(fov, 60));\n                            self.update({ fov: fov });\n                        }\n\n                        if (lon !== undefined && lat !== undefined) {\n                            //超出范围，用fix来补\n                            if (self._fix.lat + self._orient.lat + lat > 90) {\n                                self._fix.lat = 90 - self._orient.lat - lat;\n                            } else if (self._fix.lat + self._orient.lat + lat < -90) {\n                                self._fix.lat = -90 - self._orient.lat - lat;\n                            }\n                            self._touch = { lon: lon, lat: lat };\n                        }\n                    }\n                });\n            }\n\n            if (config.supportOrient) {\n                this._orienter = new _orienter2.default({\n                    onChange: function onChange(_ref2) {\n                        var lat = _ref2.lat,\n                            lon = _ref2.lon;\n                        var _fix = self._fix;\n\n                        if (!_fix.isFixed) {\n                            self._fix = {\n                                lat: _fix.lat - lat,\n                                lon: _fix.lon - lon,\n                                isFixed: true\n                            };\n                        }\n                        if (Math.abs(self._orient.lat - lat) >= 90) {\n                            return;\n                        }\n                        //超出范围，用fix来补\n                        if (self._fix.lat + self._touch.lat + lat > 90) {\n                            self._fix.lat = 90 - self._touch.lat - lat;\n                        } else if (self._fix.lat + self._touch.lat + lat < -90) {\n                            self._fix.lat = -90 - self._touch.lat - lat;\n                        }\n\n                        self._orient = { lat: lat, lon: lon };\n                    }\n                });\n            }\n        }\n    }, {\n        key: 'destroy',\n        value: function destroy() {\n            this._toucher && this._toucher.unbind();\n            this._orienter && this._orienter.destroy();\n            this._bindResize && window.removeEventListener('resize', this._bindResize);\n            cancelAnimationFrame(this._intFrame);\n        }\n    }, {\n        key: '_animate',\n        value: function _animate() {\n            var config = this._config;\n            var lat = this._touch.lat + this._fix.lat + this._orient.lat;\n            var lon = this._touch.lon + this._fix.lon + this._orient.lon;\n\n            //外部传的经纬度\n            var obj = config.onFrame(lon, lat) || {};\n            lon += obj.lon || 0;\n            lat += obj.lat || 0;\n\n            lat = Math.max(-89, Math.min(89, lat));\n\n            lat = THREE.Math.degToRad(lat);\n            lon = THREE.Math.degToRad(lon);\n\n            this.camera.target.x = 500 * Math.cos(lat) * Math.cos(lon);\n            this.camera.target.y = 500 * Math.sin(lat);\n            this.camera.target.z = 500 * Math.cos(lat) * Math.sin(lon);\n\n            this.resize();\n            this._intFrame = requestAnimationFrame(this._animate.bind(this));\n        }\n    }]);\n\n    return Opanorama;\n}();\n\nexports.default = Opanorama;\n\nwindow.Opanorama = Opanorama;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Orienter = function () {\n    function Orienter(config) {\n        _classCallCheck(this, Orienter);\n\n        this._config = Object.assign({\n            onChange: function onChange() {},\n            onOrient: function onOrient() {}\n        }, config);\n\n        this.lon = this.lat = 0;\n        this.moothFactor = 10;\n        this.boundary = 320;\n        this.direction = window.orientation || 0;\n        this.bind();\n    }\n\n    _createClass(Orienter, [{\n        key: 'bind',\n        value: function bind() {\n            window.addEventListener('deviceorientation', this._bindChange = this._onChange.bind(this));\n            window.addEventListener('orientationchange', this._bindOrient = this._onOrient.bind(this));\n        }\n    }, {\n        key: 'destroy',\n        value: function destroy() {\n            window.removeEventListener('deviceorientation', this._bindChange, false);\n            window.removeEventListener('orientationchange', this._bindOrient, false);\n        }\n    }, {\n        key: '_onOrient',\n        value: function _onOrient(event) {\n            this.direction = window.orientation;\n            this._config.onOrient(event);\n            this.lastLon = this.lastLat = undefined;\n        }\n    }, {\n        key: '_mooth',\n        value: function _mooth(x, lx) {\n            //插值为了平滑些\n\n            if (lx === undefined) {\n                return x;\n            }\n\n            //0至360,边界值特例，有卡顿待优化\n            if (Math.abs(x - lx) > this.boundary) {\n                if (lx > this.boundary) {\n                    lx = 0;\n                } else {\n                    lx = 360;\n                }\n            }\n\n            //滤波降噪\n            x = lx + (x - lx) / this.moothFactor;\n            return x;\n        }\n    }, {\n        key: '_onChange',\n        value: function _onChange(evt) {\n            switch (this.direction) {\n                case 0:\n                    this.lon = -(evt.alpha + evt.gamma);\n                    this.lat = evt.beta - 90;\n                    break;\n                case 90:\n                    this.lon = evt.alpha - Math.abs(evt.beta);\n                    this.lat = evt.gamma < 0 ? -90 - evt.gamma : 90 - evt.gamma;\n                    break;\n                case -90:\n                    this.lon = -(evt.alpha + Math.abs(evt.beta));\n                    this.lat = evt.gamma > 0 ? evt.gamma - 90 : 90 + evt.gamma;\n                    break;\n            }\n\n            this.lon = this.lon > 0 ? this.lon % 360 : this.lon % 360 + 360;\n\n            //插值为了平滑，修复部分android手机陀螺仪数字有抖动异常的\n            this.lastLat = this.lat = this._mooth(this.lat, this.lastLat);\n            this.lastLon = this.lon = this._mooth(this.lon, this.lastLon);\n\n            this._config.onChange({\n                lon: this.lon,\n                lat: this.lat\n            });\n        }\n    }]);\n\n    return Orienter;\n}();\n\nexports.default = Orienter;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Toucher = function () {\n    function Toucher(config) {\n        _classCallCheck(this, Toucher);\n\n        this.config = Object.assign({\n            radius: 50,\n            container: document.body,\n            onStart: function onStart() {},\n            onMove: function onMove() {},\n            onEnd: function onEnd() {},\n            onChange: function onChange() {}\n        }, config);\n        this.lat = this.lon = 0;\n        this.lastX = this.lastY = 0;\n        this.lastDistance = 0;\n        this.startX = this.startY = 0;\n        this.speed = { lat: 0, lon: 0 };\n        this.deceleration = 0.5;\n        this.factor = 50 / this.config.radius;\n        this.bind();\n    }\n\n    _createClass(Toucher, [{\n        key: 'bind',\n        value: function bind() {\n            var container = this.config.container;\n\n            container.addEventListener('touchstart', this._bindStart = this._onStart.bind(this));\n            container.addEventListener('touchmove', this._bindMove = this._onMove.bind(this));\n            container.addEventListener('touchend', this._bindEnd = this._onEnd.bind(this));\n        }\n    }, {\n        key: 'unbind',\n        value: function unbind() {\n            var container = this.config.container;\n\n            container.removeEventListener('touchstart', this._bindStart);\n            container.removeEventListener('touchmove', this._bindMove);\n            container.removeEventListener('touchend', this._bindEnd);\n        }\n    }, {\n        key: '_onStart',\n        value: function _onStart(event) {\n            var evt = event.changedTouches[0];\n            this.startX = this.lastX = evt.clientX;\n            this.startY = this.lastY = evt.clientY;\n            this.startTime = Date.now();\n            this.config.onStart(event);\n            this.speed = { lat: 0, lon: 0 };\n            this.lastDistance = undefined;\n        }\n    }, {\n        key: '_onMove',\n        value: function _onMove(event) {\n            event.preventDefault();\n            var evt = event.changedTouches[0];\n            switch (event.changedTouches.length) {\n                case 1:\n                    if (!this.lastDistance) {\n                        this.lon += (this.lastX - evt.clientX) * this.factor;\n                        this.lat += (evt.clientY - this.lastY) * this.factor;\n\n                        this.lastX = evt.clientX;\n                        this.lastY = evt.clientY;\n\n                        this.config.onChange({\n                            lat: this.lat,\n                            lon: this.lon\n                        });\n                    }\n                    break;\n                case 2:\n                    var evt1 = event.changedTouches[1];\n                    var distance = Math.abs(evt.clientX - evt1.clientX) + Math.abs(evt.clientY - evt1.clientY);\n                    if (this.lastDistance === undefined) {\n                        this.lastDistance = distance;\n                    }\n                    var scale = distance / this.lastDistance;\n\n                    if (scale) {\n                        this.config.onChange({ scale: scale });\n                        this.lastDistance = distance;\n                    }\n            }\n            this.config.onMove(event);\n        }\n    }, {\n        key: '_onEnd',\n        value: function _onEnd(event) {\n            //惯性\n            var t = (Date.now() - this.startTime) / 10;\n            this.speed = {\n                lat: (this.startY - this.lastY) / t,\n                lon: (this.startX - this.lastX) / t\n            };\n\n            this._inertance();\n            this.config.onEnd(event);\n        }\n    }, {\n        key: '_subSpeed',\n        value: function _subSpeed(speed) {\n            if (speed !== 0) {\n                if (speed > 0) {\n                    speed -= this.deceleration;\n                    speed < 0 && (speed = 0);\n                } else {\n                    speed += this.deceleration;\n                    speed > 0 && (speed = 0);\n                }\n            }\n            return speed;\n        }\n    }, {\n        key: '_inertance',\n        value: function _inertance() {\n            var speed = this.speed;\n            speed.lat = this._subSpeed(speed.lat);\n            speed.lon = this._subSpeed(speed.lon);\n\n            this.lat -= speed.lat;\n            this.lon += speed.lon;\n\n            this.config.onChange({\n                isUserInteracting: false,\n                speed: speed,\n                lat: this.lat,\n                lon: this.lon\n            });\n\n            if (speed.lat === 0 && speed.lon === 0) {\n                this._intFrame && cancelAnimationFrame(this._intFrame);\n                this._intFrame = 0;\n            } else {\n                this._intFrame = requestAnimationFrame(this._inertance.bind(this));\n            }\n        }\n    }]);\n\n    return Toucher;\n}();\n\nexports.default = Toucher;\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// Opanorama.js?b0b195444e0c3ad8a21c"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1a9744ff6f74773b96cc","import Orienter from './orienter'\r\nimport Toucher from './toucher'\r\n\r\nexport default class Opanorama {\r\n    constructor(config) {\r\n        this._config = Object.assign({\r\n            url: '',                    //全景图片\r\n            container: document.body,   //容器\r\n            radius: 500,                //球体半径\r\n            fov: 90,                    //相机视角，可用于放大和缩小图片\r\n            offsetLongitude: 0,         //经度偏移量，可用于默认展示图片位置\r\n            offsetLatitude: 0,          //纬度偏移量，可用于默认展示图片位置\r\n            supportTouch: true,         //是否支持手指滑动\r\n            supportOrient: true,        //是否支持陀螺仪\r\n            onFrame(lon, lat) {\r\n                return {lon, lat};\r\n            }\r\n        }, config);\r\n\r\n\r\n        this._config.width = config.container.clientWidth;\r\n        this._config.height = config.container.clientHeight;\r\n\r\n\r\n        config = this._config;\r\n\r\n        this._fix = {\r\n            lat: config.offsetLatitude || 0,\r\n            lon: config.offsetLongitude || 180,\r\n            isFixed: config.offsetLatitude || config.offsetLongitude\r\n        };\r\n\r\n        this._touch = this._orient = {\r\n            lat: 0,\r\n            lon: 0\r\n        };\r\n\r\n        this._initStage();\r\n        this.resize();\r\n        this._animate();\r\n        this._initControl();\r\n    }\r\n\r\n\r\n    update(config = {}) {\r\n        this._config = Object.assign({}, this._config, config);\r\n\r\n        if (config.width || config.height) {\r\n            this.renderer.setSize(this._config.width, this._config.height);\r\n            this.camera.aspect = this._config.width / this._config.height;\r\n        }\r\n        if (config.fov) {\r\n            this.camera.fov = config.fov;\r\n        }\r\n        this.camera.updateProjectionMatrix();\r\n        this.resize();\r\n    }\r\n\r\n    resize() {\r\n        this.camera.lookAt(this.camera.target);\r\n        this.renderer.render(this.scene, this.camera);\r\n    }\r\n\r\n    _initStage() {\r\n        const {container, width, height, url, fov, radius} = this._config;\r\n        this.camera = new THREE.PerspectiveCamera(fov, width / height, 1, 1100);\r\n        this.camera.target = new THREE.Vector3(0, 0, 0);\r\n        this.scene = new THREE.Scene();\r\n\r\n        var geometry = new THREE.SphereBufferGeometry(radius, 60, 40);\r\n        geometry.scale(-1, 1, 1);\r\n        var material = new THREE.MeshBasicMaterial({\r\n            map: new THREE.TextureLoader().load(url)\r\n        });\r\n        var mesh = new THREE.Mesh(geometry, material);\r\n        this.scene.add(mesh);\r\n\r\n        this.renderer = new THREE.WebGLRenderer();\r\n        this.renderer.setPixelRatio(window.devicePixelRatio);\r\n        this.renderer.setSize(width, height);\r\n        this.canvas = this.renderer.domElement;\r\n        container.appendChild(this.canvas);\r\n\r\n        window.addEventListener('resize', this._bindResize = this._onResize.bind(this));\r\n    }\r\n\r\n    _onResize() {\r\n        const {container} = this._config;\r\n        this.update({\r\n            width: container.clientWidth,\r\n            height: container.clientHeight\r\n        });\r\n    }\r\n\r\n    _initControl() {\r\n        const self = this;\r\n        const config = this._config;\r\n\r\n        if (config.supportTouch) {\r\n            let fov;\r\n            this._toucher = new Toucher({\r\n                container: config.container,\r\n                radius: config.radius,\r\n                onChange({lon, lat, scale}) {\r\n                    if (scale) {\r\n                        fov = self._config.fov / scale;\r\n                        fov = Math.min(120, Math.max(fov, 60));\r\n                        self.update({fov});\r\n                    }\r\n\r\n                    if (lon !== undefined && lat !== undefined) {\r\n                        //超出范围，用fix来补\r\n                        if (self._fix.lat + self._orient.lat + lat > 90) {\r\n                            self._fix.lat = 90 - self._orient.lat - lat;\r\n                        } else if (self._fix.lat + self._orient.lat + lat < -90) {\r\n                            self._fix.lat = -90 - self._orient.lat - lat;\r\n                        }\r\n                        self._touch = {lon, lat};\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (config.supportOrient) {\r\n            this._orienter = new Orienter({\r\n                onChange({lat, lon}) {\r\n                    const {_fix} = self;\r\n                    if (!_fix.isFixed) {\r\n                        self._fix = {\r\n                            lat: _fix.lat - lat,\r\n                            lon: _fix.lon - lon,\r\n                            isFixed: true\r\n                        };\r\n                    }\r\n                    if (Math.abs(self._orient.lat - lat) >= 90) {\r\n                        return;\r\n                    }\r\n                    //超出范围，用fix来补\r\n                    if (self._fix.lat + self._touch.lat + lat > 90) {\r\n                        self._fix.lat = 90 - self._touch.lat - lat;\r\n                    } else if (self._fix.lat + self._touch.lat + lat < -90) {\r\n                        self._fix.lat = -90 - self._touch.lat - lat;\r\n                    }\r\n\r\n                    self._orient = {lat, lon};\r\n                }\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n    destroy() {\r\n        this._toucher && this._toucher.unbind();\r\n        this._orienter && this._orienter.destroy();\r\n        this._bindResize && window.removeEventListener('resize', this._bindResize);\r\n        cancelAnimationFrame(this._intFrame);\r\n    }\r\n\r\n    _animate() {\r\n        const config = this._config;\r\n        let lat = this._touch.lat + this._fix.lat + this._orient.lat;\r\n        let lon = this._touch.lon + this._fix.lon + this._orient.lon;\r\n\r\n        //外部传的经纬度\r\n        let obj = config.onFrame(lon, lat)||{};\r\n        lon += (obj.lon || 0);\r\n        lat += (obj.lat || 0);\r\n\r\n\r\n        lat = Math.max(-89, Math.min(89, lat));\r\n\r\n        lat = THREE.Math.degToRad(lat);\r\n        lon = THREE.Math.degToRad(lon);\r\n\r\n        this.camera.target.x = 500 * Math.cos(lat) * Math.cos(lon);\r\n        this.camera.target.y = 500 * Math.sin(lat);\r\n        this.camera.target.z = 500 * Math.cos(lat) * Math.sin(lon);\r\n\r\n        this.resize();\r\n        this._intFrame = requestAnimationFrame(this._animate.bind(this));\r\n    }\r\n\r\n}\r\nwindow.Opanorama = Opanorama;\n\n\n// WEBPACK FOOTER //\n// ./src/Opanorama.js","export default class Orienter {\r\n    constructor(config) {\r\n        this._config = Object.assign({\r\n            onChange() {\r\n            },\r\n            onOrient() {\r\n            }\r\n        }, config);\r\n\r\n        this.lon = this.lat = 0;\r\n        this.moothFactor = 10;\r\n        this.boundary = 320;\r\n        this.direction = window.orientation || 0;\r\n        this.bind();\r\n    }\r\n\r\n\r\n    bind() {\r\n        window.addEventListener('deviceorientation', this._bindChange = this._onChange.bind(this));\r\n        window.addEventListener('orientationchange', this._bindOrient = this._onOrient.bind(this));\r\n    }\r\n\r\n\r\n    destroy() {\r\n        window.removeEventListener('deviceorientation', this._bindChange, false);\r\n        window.removeEventListener('orientationchange', this._bindOrient, false);\r\n    }\r\n\r\n\r\n    _onOrient(event) {\r\n        this.direction = window.orientation;\r\n        this._config.onOrient(event);\r\n        this.lastLon = this.lastLat = undefined\r\n    }\r\n\r\n    _mooth(x, lx) { //插值为了平滑些\r\n\r\n        if (lx === undefined) {\r\n            return x;\r\n        }\r\n\r\n        //0至360,边界值特例，有卡顿待优化\r\n        if (Math.abs(x - lx) > this.boundary) {\r\n            if (lx > this.boundary) {\r\n               lx = 0;\r\n            }else {\r\n                lx =360;\r\n            }\r\n        }\r\n\r\n\r\n        //滤波降噪\r\n        x = lx + (x-lx) / this.moothFactor;\r\n        return x;\r\n    }\r\n\r\n    _onChange(evt) {\r\n        switch (this.direction) {\r\n            case 0 :\r\n                this.lon = -(evt.alpha + evt.gamma);\r\n                this.lat = evt.beta - 90;\r\n                break;\r\n            case 90:\r\n                this.lon = evt.alpha - Math.abs(evt.beta);\r\n                this.lat = evt.gamma < 0 ? -90 - evt.gamma : 90 - evt.gamma;\r\n                break;\r\n            case -90:\r\n                this.lon = -(evt.alpha + Math.abs(evt.beta));\r\n                this.lat = evt.gamma > 0 ? evt.gamma - 90 : 90 + evt.gamma;\r\n                break;\r\n        }\r\n\r\n        this.lon = this.lon > 0 ? this.lon % 360 : this.lon % 360 + 360;\r\n\r\n        //插值为了平滑，修复部分android手机陀螺仪数字有抖动异常的\r\n        this.lastLat = this.lat = this._mooth(this.lat, this.lastLat);\r\n        this.lastLon = this.lon = this._mooth(this.lon, this.lastLon);\r\n\r\n        this._config.onChange({\r\n            lon: this.lon,\r\n            lat: this.lat\r\n        });\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/orienter.js","export default class Toucher {\r\n    constructor(config) {\r\n        this.config = Object.assign({\r\n            radius: 50,\r\n            container: document.body,\r\n            onStart() {\r\n            },\r\n            onMove() {\r\n            },\r\n            onEnd() {\r\n            },\r\n            onChange() {\r\n            }\r\n        }, config);\r\n        this.lat = this.lon = 0;\r\n        this.lastX = this.lastY = 0;\r\n        this.lastDistance = 0;\r\n        this.startX = this.startY = 0;\r\n        this.speed = {lat: 0, lon: 0};\r\n        this.deceleration = 0.5;\r\n        this.factor = 50 / this.config.radius;\r\n        this.bind();\r\n    }\r\n\r\n    bind() {\r\n        const {container} = this.config;\r\n        container.addEventListener('touchstart', this._bindStart = this._onStart.bind(this));\r\n        container.addEventListener('touchmove', this._bindMove = this._onMove.bind(this));\r\n        container.addEventListener('touchend', this._bindEnd = this._onEnd.bind(this));\r\n\r\n    }\r\n\r\n    unbind() {\r\n        const {container} = this.config;\r\n        container.removeEventListener('touchstart', this._bindStart);\r\n        container.removeEventListener('touchmove', this._bindMove);\r\n        container.removeEventListener('touchend', this._bindEnd);\r\n    }\r\n\r\n    _onStart(event) {\r\n        const evt = event.changedTouches[0];\r\n        this.startX = this.lastX = evt.clientX;\r\n        this.startY = this.lastY = evt.clientY;\r\n        this.startTime = Date.now();\r\n        this.config.onStart(event);\r\n        this.speed = {lat: 0, lon: 0};\r\n        this.lastDistance = undefined;\r\n    }\r\n\r\n    _onMove(event) {\r\n        event.preventDefault();\r\n        const evt = event.changedTouches[0];\r\n        switch (event.changedTouches.length) {\r\n            case 1 :\r\n                if (!this.lastDistance) {\r\n                    this.lon += (this.lastX - evt.clientX) * this.factor;\r\n                    this.lat += (evt.clientY - this.lastY) * this.factor;\r\n\r\n                    this.lastX = evt.clientX;\r\n                    this.lastY = evt.clientY;\r\n\r\n                    this.config.onChange({\r\n                        lat: this.lat,\r\n                        lon: this.lon\r\n                    });\r\n                }\r\n                break;\r\n            case 2:\r\n                const evt1 = event.changedTouches[1];\r\n                let distance = Math.abs(evt.clientX - evt1.clientX) + Math.abs(evt.clientY - evt1.clientY);\r\n                if (this.lastDistance === undefined) {\r\n                    this.lastDistance = distance;\r\n                }\r\n                let scale = distance / this.lastDistance;\r\n\r\n                if (scale) {\r\n                    this.config.onChange({scale});\r\n                    this.lastDistance = distance;\r\n                }\r\n        }\r\n        this.config.onMove(event);\r\n    }\r\n\r\n    _onEnd(event) {\r\n        //惯性\r\n        let t = (Date.now() - this.startTime) / 10;\r\n        this.speed = {\r\n            lat: (this.startY - this.lastY) / t,\r\n            lon: (this.startX - this.lastX) / t\r\n        };\r\n\r\n        this._inertance();\r\n        this.config.onEnd(event);\r\n    }\r\n\r\n    _subSpeed(speed) {\r\n        if (speed !== 0) {\r\n            if (speed > 0) {\r\n                speed -= this.deceleration;\r\n                speed < 0 && (speed = 0);\r\n            } else {\r\n                speed += this.deceleration;\r\n                speed > 0 && (speed = 0);\r\n            }\r\n        }\r\n        return speed;\r\n    }\r\n\r\n    _inertance() {\r\n        const speed = this.speed;\r\n        speed.lat = this._subSpeed(speed.lat);\r\n        speed.lon = this._subSpeed(speed.lon);\r\n\r\n        this.lat -= speed.lat;\r\n        this.lon += speed.lon;\r\n\r\n\r\n        this.config.onChange({\r\n            isUserInteracting: false,\r\n            speed,\r\n            lat: this.lat,\r\n            lon: this.lon\r\n        });\r\n\r\n        if (speed.lat === 0 && speed.lon === 0) {\r\n            this._intFrame && cancelAnimationFrame(this._intFrame);\r\n            this._intFrame = 0;\r\n        } else {\r\n            this._intFrame = requestAnimationFrame(this._inertance.bind(this));\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/toucher.js"],"sourceRoot":""}